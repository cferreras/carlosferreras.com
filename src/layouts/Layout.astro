---
// Layout.astro
import { ClientRouter } from 'astro:transitions';
import Footer from "../components/Footer.astro";
import LanguageSwitcher from "../components/LanguageSwitcher.astro";
import SEO from "../components/SEO.astro";
import { getTranslations, type Lang } from "../i18n/translations";
import "../styles/global.css";

interface Props {
  maxWidth?: 'md' | 'xl';
  lang?: Lang;
  seo?: {
    title?: string;
    description?: string;
    keywords?: string[];
    ogType?: 'website' | 'article' | 'profile';
    ogImage?: string;
    canonicalUrl?: string;
    noindex?: boolean;
    article?: {
      publishedTime: Date;
      modifiedTime?: Date;
      author: string;
      tags?: string[];
    };
  };
}

const { maxWidth = 'md', lang = 'es', seo } = Astro.props;
const t = getTranslations(lang);
const maxWidthClass1 = maxWidth === 'xl' ? 'max-w-7xl' : 'max-w-xl';
const maxWidthClass2 = maxWidth === 'xl' ? 'max-w-7xl' : 'max-w-md';

// Build alternate language URLs
const currentPath = Astro.url.pathname;
const baseUrl = t.site.url;
const alternateLang = lang === 'es' ? 'en' : 'es';
const alternatePath = currentPath.replace(/^\/(es|en)\//, '/').replace(/^\//, `/${alternateLang}/`);
const alternateUrl = `${baseUrl}${alternatePath}`;
const currentUrl = `${baseUrl}${currentPath}`;

const alternateLangs = [
  { lang: alternateLang, url: alternateUrl },
];

// SEO configuration
const seoTitle = seo?.title || t.site.title;
const seoDescription = seo?.description || t.site.description;
const seoKeywords = seo?.keywords || t.site.keywords;
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- SEO Component -->
		<SEO
			title={seoTitle}
			description={seoDescription}
			lang={lang}
			keywords={seoKeywords}
			author={t.site.author}
			canonicalUrl={seo?.canonicalUrl || currentUrl}
			robots={seo?.noindex ? 'noindex, nofollow' : 'index, follow'}
			ogType={seo?.ogType || 'website'}
			ogImage={seo?.ogImage || t.site.ogImage}
			ogSiteName={t.site.title}
			alternateLangs={alternateLangs}
			article={seo?.article}
		/>
		
		<ClientRouter />
	</head>
	<body class="min-h-screen flex flex-col">
		<div class="noise-overlay"></div>
		<div class="fixed top-4 right-4 z-50">
			<LanguageSwitcher currentLang={lang} />
		</div>
		<main class={`flex-1 flex flex-col items-center justify-center p-4 ${maxWidthClass1} mx-auto w-full`} transition:animate="fade" transition:name="main">
			<div class="relative flex flex-col items-center justify-center w-full">
				<slot />
			</div>
		</main>
		<Footer lang={lang} transition:name="footer" transition:persist />
	</body>
</html>

<style>
	body {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
		background-color: #000;
	}

	.noise-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		pointer-events: none;
		z-index: 9999;
		opacity: 0.05;
		background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
	}
</style>
