---
interface Props {
  currentLang: 'es' | 'en';
  alternativeUrls?: {
    es?: string;
    en?: string;
  };
}

const { currentLang, alternativeUrls } = Astro.props;

// Obtener la ruta actual sin el prefijo de idioma
const currentPath = Astro.url.pathname;
const pathWithoutLang = currentPath.replace(/^\/en/, '') || '/';

// Determinar las URLs para cada idioma
let esUrl: string;
let enUrl: string;

if (alternativeUrls) {
  // Si se proporcionan URLs alternativas específicas (ej: desde un post), usarlas
  esUrl = alternativeUrls.es ?? '/';
  enUrl = alternativeUrls.en ?? '/en/';
} else {
  // Lógica por defecto: intercambiar prefijos
  // Si estamos en /en/blog/my-post.md y pulsamos ES -> /blog/my-post.md
  // Pero si el post no existe en español, esto dará 404
  // Por eso detectamos si estamos en un post individual
  
  const isBlogPost = pathWithoutLang.match(/^\/blog\/.+/);
  
  if (isBlogPost && currentLang === 'en') {
    // Estamos en un post en inglés y queremos ir al español
    // Como no sabemos si existe equivalente, vamos al listado de posts
    esUrl = '/blog/';
    enUrl = currentPath; // Ya estamos aquí
  } else if (isBlogPost && currentLang === 'es') {
    // Estamos en un post en español y queremos ir al inglés
    // Vamos al listado de posts en inglés
    esUrl = currentPath;
    enUrl = '/en/blog/';
  } else {
    // No es un post, usar la ruta normal
    esUrl = pathWithoutLang;
    enUrl = `/en${pathWithoutLang === '/' ? '' : pathWithoutLang}`;
  }
}
---

<div class="language-switcher animate-in delay-1">
  <div class="flex items-center gap-1 text-sm">
    <a 
      href={esUrl} 
      class={`lang-link ${currentLang === 'es' ? 'active' : ''}`}
      aria-label="Cambiar a español"
    >
      ES
    </a>
    <span class="text-zinc-600">/</span>
    <a 
      href={enUrl} 
      class={`lang-link ${currentLang === 'en' ? 'active' : ''}`}
      aria-label="Switch to English"
    >
      EN
    </a>
  </div>
</div>

<style>
  .language-switcher {
    display: inline-flex;
    align-items: center;
  }

  .lang-link {
    color: #52525b;
    text-decoration: none;
    padding: 0.125rem 0.25rem;
    transition: color 0.2s ease;
    font-size: 0.875rem;
  }

  .lang-link:hover {
    color: #a1a1aa;
  }

  .lang-link.active {
    color: #fff;
    font-weight: 500;
  }

  .lang-link.active:hover {
    color: #fff;
  }
</style>
