---
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';
import { getTranslations, type Lang } from "../i18n/translations";

interface Props {
  lang?: Lang;
}

const { lang = 'es' } = Astro.props;
const t = getTranslations(lang);

const posts = await getCollection('posts', ({ data }) => {
  const isPublished = import.meta.env.DEV || !data.draft;
  const isCorrectLang = data.lang === lang;
  return isPublished && isCorrectLang;
});

const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat(lang === 'es' ? 'es-ES' : 'en-US', {
    day: 'numeric',
    month: 'short',
    year: 'numeric',
  }).format(date);
}

const basePath = lang === 'es' ? '/blog' : '/en/blog';
---

<section class="w-full mt-8">
    <div class="flex flex-col gap-0">
        {sortedPosts.length === 0 ? (
            <p class="text-zinc-600 py-4">{lang === 'es' ? 'No hay posts disponibles todav√≠a.' : 'No posts available yet.'}</p>
        ) : (
            sortedPosts.map((post) => (
                <a 
                    href={`${basePath}/${post.id.replace(/\.md$/, '')}`} 
                    class="post-link group"
                >
                    <div class="flex items-center gap-3">
                        {post.data.draft && (
                            <span class="draft-badge">Draft</span>
                        )}
                        <span class="post-title">{post.data.title}</span>
                    </div>
                    <span class="post-date">
                        {formatDate(post.data.pubDate)}
                    </span>
                </a>
            ))
        )}
    </div>
</section>

<style>
    .post-link {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: baseline;
        padding: 14px 0;
        border-bottom: 1px solid #18181b;
        color: #e4e4e7;
        transition: all 0.3s var(--timing-smooth, cubic-bezier(0.22, 1, 0.36, 1));
    }

    .post-link:hover {
        color: #f5a623;
        border-color: #27272a;
        padding-left: 8px;
    }

    .post-title {
        font-size: 0.9375rem;
        letter-spacing: -0.01em;
    }

    .post-date {
        font-size: 0.75rem;
        color: #52525b;
        transition: color 0.2s ease;
    }

    .post-link:hover .post-date {
        color: #71717a;
    }

    .draft-badge {
        font-size: 0.625rem;
        background: rgba(245, 166, 35, 0.15);
        color: #f5a623;
        padding: 2px 6px;
        border-radius: 3px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
</style>
